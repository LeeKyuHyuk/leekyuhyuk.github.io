<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta property="og:image" content="https://kyuhyuk.kr/thumbnail.png"/><title>Nest.js로 GraphQL 서버 구축하기</title><meta name="author" content="KyuHyuk Lee"/><meta name="generator" content="KyuHyuk Lee"/><meta name="description" content=" Nest.js 에 GraphQL 서버를 구축하는 방법을 정리해보았습니다. Nest.js 프로젝트 생성 npm init 를 사용하여 아래와 같이 package.json 을 생성합니다. 아래의 패키지를 설치합니다. npm install --save @nestjs/axios @nestjs/"/><meta itemProp="url" content="https://kyuhyuk.kr/article/graphql/2021/09/16/Building-a-GraphQL-Server-with-NestJS"/><meta itemProp="headline" content="Nest.js로 GraphQL 서버 구축하기"/><meta property="og:type" content="article"/><meta property="og:url" content="https://kyuhyuk.kr/article/graphql/2021/09/16/Building-a-GraphQL-Server-with-NestJS"/><meta property="og:title" content="Nest.js로 GraphQL 서버 구축하기"/><meta property="og:description" content=" Nest.js 에 GraphQL 서버를 구축하는 방법을 정리해보았습니다. Nest.js 프로젝트 생성 npm init 를 사용하여 아래와 같이 package.json 을 생성합니다. 아래의 패키지를 설치합니다. npm install --save @nestjs/axios @nestjs/"/><meta property="og:site_name" content="KyuHyuk Blog"/><meta property="og:locale" content="ko_KR"/><meta name="next-head-count" content="15"/><style id="stitches">--sxs{--sxs:2 c-opBYf c-bHyrwK c-uBnvQ c-hehuMV c-bjkCdF c-hAoZGi c-jfcKOQ c-ezyKJG c-iAzQif c-bvdusc c-ezRQNp c-iosjjB c-jYwCTI c-iOPkYY c-cpkrrK c-fiqONv c-iUFgVP c-cshSRb c-fxvkZv c-dIcdES}@media{.c-opBYf{display:flex;align-items:center;background:#FFFFFF;height:60px;justify-content:space-between;-webkit-box-align:center;-webkit-box-pack:justify}.c-bHyrwK{display:flex;align-items:center;justify-content:center;-webkit-box-align:center;-webkit-box-pack:center}.c-uBnvQ{width:32px;height:32px;color:#FFFFFF;background:#000000;border-radius:4px;display:flex;align-items:center;justify-content:center;margin-right:12px;font-weight:700;cursor:default;-webkit-box-align:center;-webkit-box-pack:center}.c-hehuMV{font-weight:900;font-size:18px;letter-spacing:0.5px;color:#000000;cursor:default}.c-bjkCdF{list-style:none;padding:0;margin:0;display:flex;justify-content:center;align-items:center;font-size:24px;color:rgb(134, 142, 150);transition:all 0.3s ease 0s;-webkit-box-pack:center;-webkit-box-align:center}.c-hAoZGi{font-size:28px;color:inherit;text-decoration:none;margin:8px}.c-jfcKOQ{max-width:768px;margin-top:2rem;margin-left:auto;margin-right:auto}.c-ezyKJG{min-width:72px;display:flex;flex-direction:row;justify-content:center;align-items:center;padding:6px 16px;background:#12B886;box-shadow:0px 1px 2px rgba(98, 16, 204, 0.3);border:none;border-radius:14px;vertical-align:middle;color:#FFFFFF;font-size:1rem;height:2rem;float:right}.c-iAzQif{display:inline-block;margin-top:2rem}.c-bvdusc{font-size:2rem;line-height:1.5;letter-spacing:-0.004em;margin-top:0;margin-bottom:2rem;font-weight:700;color:#212529;word-break:keep-all;transition:color 0.125s ease-in 0s;}.c-ezRQNp{font-size:1.125rem;color:#212529;transition:color 0.125s ease-in 0s;;line-height:1.7;letter-spacing:-0.004em;word-break:break-all;overflow-wrap:break-word}.c-iosjjB{background:#F8F9FA;padding:0 1rem;height:2rem;border-radius:1rem;display:inline-flex;align-items:center;margin-right:0.875rem;color:#12B886;text-decoration:none;font-weight:400;font-size:1rem}.c-jYwCTI{font-size:1rem;color:#495057}.c-iOPkYY{margin-top:3rem;background-color:rgba(51,51,51,.1);border:0;height:1px}.c-cpkrrK{width:100%;height:300px;display:flex;align-items:center;justify-content:center;flex-direction:column;-webkit-box-align:center;-webkit-box-pack:center}.c-fiqONv{color:rgb(206, 212, 218);margin-bottom:8px;font-size:22px;font-weight:700}.c-iUFgVP{width:32px;height:32px;color:#FFFFFF;background:rgb(206, 212, 218);border-radius:4px;display:flex;align-items:center;justify-content:center;margin-right:12px;font-weight:700;cursor:default;-webkit-box-align:center;-webkit-box-pack:center}.c-cshSRb{font-weight:900;font-size:18px;letter-spacing:0.5px;color:rgb(206, 212, 218);cursor:default;text-transform:uppercase}.c-fxvkZv{font-size:2.5rem;line-height:1.5;letter-spacing:-0.004em;margin-top:0;margin-bottom:2rem;font-weight:700;color:#212529;word-break:keep-all;transition:color 0.125s ease-in 0s;}.c-dIcdES{margin-top:2rem;font-size:1.125rem;color:#212529;transition:color 0.125s ease-in 0s;;line-height:1.7;letter-spacing:-0.004em;word-break:keep-all;overflow-wrap:break-word}}</style><link rel="preload" href="/_next/static/css/98b299b94b0a7962.css" as="style"/><link rel="stylesheet" href="/_next/static/css/98b299b94b0a7962.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c2a527101433f11d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c2a527101433f11d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-af3068766efac2e7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1152a1d584800b30.js" defer=""></script><script src="/_next/static/chunks/413-67b20b8229b03582.js" defer=""></script><script src="/_next/static/chunks/796-a00c9a8c08a47d16.js" defer=""></script><script src="/_next/static/chunks/pages/article/%5Bcategory%5D/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bslug%5D-a6ddc2a5f4e4754e.js" defer=""></script><script src="/_next/static/sFagy2B10ejf-tz-1N1o9/_buildManifest.js" defer=""></script><script src="/_next/static/sFagy2B10ejf-tz-1N1o9/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="c-opBYf"><a href="https://kyuhyuk.kr"><div class="c-bHyrwK"><div class="c-uBnvQ">Kh.</div><div class="c-hehuMV">KyuHyuk Blog</div></div></a><ul class="c-bjkCdF"><li><a href="https://github.com/LeeKyuHyuk" class="c-hAoZGi"><span role="img" aria-label="github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></span></a></li><li><a href="https://linkedin.com/in/leekyuhyuk" class="c-hAoZGi"><span role="img" aria-label="linkedin" class="anticon anticon-linkedin"><svg viewBox="64 64 896 896" focusable="false" data-icon="linkedin" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM349.3 793.7H230.6V411.9h118.7v381.8zm-59.3-434a68.8 68.8 0 1168.8-68.8c-.1 38-30.9 68.8-68.8 68.8zm503.7 434H675.1V608c0-44.3-.8-101.2-61.7-101.2-61.7 0-71.2 48.2-71.2 98v188.9H423.7V411.9h113.8v52.2h1.6c15.8-30 54.5-61.7 112.3-61.7 120.2 0 142.3 79.1 142.3 181.9v209.4z"></path></svg></span></a></li><li><a href="mailto:lee@kyuhyuk.kr" class="c-hAoZGi"><span role="img" aria-label="mail" class="anticon anticon-mail"><svg viewBox="64 64 896 896" focusable="false" data-icon="mail" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-80.8 108.9L531.7 514.4c-7.8 6.1-18.7 6.1-26.5 0L189.6 268.9A7.2 7.2 0 01194 256h648.8a7.2 7.2 0 014.4 12.9z"></path></svg></span></a></li></ul></header><main class="c-jfcKOQ"><article><h1 class="c-fxvkZv"><a href="https://kyuhyuk.kr/article/graphql/2021/09/16/Building-a-GraphQL-Server-with-NestJS">Nest.js로 GraphQL 서버 구축하기</a></h1><a href="https://kyuhyuk.kr/category/GraphQL" class="c-iosjjB">GraphQL</a><time dateTime="2021-09-16 00:12:10" class="c-jYwCTI">Sep 16, 2021 12:12:10 AM</time><div id="post" class="c-dIcdES"><p><a href="https://nestjs.com">Nest.js</a>에 GraphQL 서버를 구축하는 방법을 정리해보았습니다.</p>
<h1>Nest.js 프로젝트 생성</h1>
<p><code>npm init</code>를 사용하여 아래와 같이 <code>package.json</code>을 생성합니다.<br>
<img src="/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_1.png" alt="Create NestJS Project"></p>
<p>아래의 패키지를 설치합니다.</p>
<pre><code class="language-bash">npm install --save @nestjs/axios @nestjs/common @nestjs/core @nestjs/platform-express reflect-metadata rxjs
npm install --save-dev @nestjs/cli @nestjs/schematics @types/express @types/node ts-loader ts-node tsconfig-paths typescript
</code></pre>
<p><code>package.json</code>에 <code>&quot;main&quot;: &quot;index.js&quot;</code> 행을 삭제하고 아래 내용을 추가합니다.</p>
<pre><code class="language-json">  <span class="hljs-attr">&quot;private&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;build&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nest build&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nest start&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;start:dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NODE_ENV=development nest start --watch&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;start:debug&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NODE_ENV=development nest start --debug --watch&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;start:prod&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npm run build &amp;&amp; NODE_ENV=production node dist/main&quot;</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p><code>nest-cli.json</code>, <code>tsconfig.build.json</code>, <code>tsconfig.json</code>을 아래와 같이 작성하여 저장합니다.</p>
<p><strong><code>nest-cli.json</code> :</strong></p>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;collection&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@nestjs/schematics&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;sourceRoot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;src&quot;</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong><code>tsconfig.build.json</code> :</strong></p>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;extends&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./tsconfig.json&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;exclude&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;node_modules&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;dist&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;**/*spec.ts&quot;</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong><code>tsconfig.json</code> :</strong></p>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;commonjs&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;declaration&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;removeComments&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;emitDecoratorMetadata&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;experimentalDecorators&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;allowSyntheticDefaultImports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;target&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;es2017&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;sourceMap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;outDir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./dist&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;incremental&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;skipLibCheck&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h1>Nest.js 프로젝트에 GraphQL 추가 및 설정</h1>
<p>아래의 패키지를 설치합니다.</p>
<pre><code class="language-bash">npm install --save @nestjs/graphql apollo-server-express graphql
</code></pre>
<p><code>src</code> 폴더를 만들고 <code>src/app.module.ts</code>와 <code>src/main.ts</code>를 생성합니다.</p>
<p><strong><code>src/app.module.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GraphQLModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/graphql&#x27;</span>;

<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">GraphQLModule</span>.<span class="hljs-title function_">forRoot</span>({})],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<p>위의 코드에서 <code>forRoot()</code>에 <a href="https://www.apollographql.com/docs/apollo-server/v2/api/apollo-server.html#constructor-options-lt-ApolloServer-gt">여러 설정</a>을넣을 수 있습니다. <a href="https://www.apollographql.com/docs/apollo-server/v2/api/apollo-server.html#constructor-options-lt-ApolloServer-gt">설정값</a>은기본 Apollo 인스턴스로 전달됩니다.<br>
예를 들어 <code>playground</code>와 <code>debug</code>를 끄려면 다음과 같이 사용할 수 있습니다.</p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GraphQLModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/graphql&#x27;</span>;

<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title class_">GraphQLModule</span>.<span class="hljs-title function_">forRoot</span>({
      <span class="hljs-attr">debug</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">playground</span>: <span class="hljs-literal">false</span>,
    }),
  ],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<p><strong><code>src/main.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NestFactory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/core&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./app.module&#x27;</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>);
  <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
}
<span class="hljs-title function_">bootstrap</span>();
</code></pre>
<h1>Resolver, Schema 생성</h1>
<p>아마 위의 코드를 모두 작성하고 <code>npm run start:dev</code>를 하면 <code>UnhandledPromiseRejectionWarning: Error: Apollo Server requires either an existing schema, modules or typeDefs</code>라고 오류가 발생할 것입니다.</p>
<p>이 오류가 발생하는 이유는 Resolver, Schema가 없어서 발생하는 오류입니다.<br>
여기서 말하는 Resolver는 GraphQL 작업(Query, Mutation, Subscription)을 데이터로 변환하기 위해 사용됩니다.</p>
<p>Schema는 아래와 같이 정의할 수 있습니다. 간단하게 주소록에 필요한 Schema를 작성해보겠습니다.</p>
<p><code>graphql</code> 폴더를 생성하고 <code>person.graphql</code> 파일을 생성합니다.</p>
<p><strong><code>graphql/person.graphql</code> :</strong></p>
<pre><code class="language-graphql"><span class="hljs-keyword">type</span> Person <span class="hljs-punctuation">{</span>
  <span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">!</span>
  <span class="hljs-symbol">name</span><span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">!</span>
  <span class="hljs-symbol">number</span><span class="hljs-punctuation">:</span> String
  <span class="hljs-symbol">email</span><span class="hljs-punctuation">:</span> String
<span class="hljs-punctuation">}</span>

<span class="hljs-keyword">type</span> <span class="hljs-keyword">Query</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-symbol">getAllPerson</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>Person<span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>GraphQL에서 사용되는 Schema와 Type이 궁금하다면 <a href="https://graphql.org/learn/schema/">https://graphql.org/learn/schema</a>를 읽어보세요.</p>
<p>그리고 <code>src/app.module.ts</code>에 <code>typePaths</code>를 추가하여 <code>.graphql</code> 확장자를 가진 파일을 GraphQL의 Schema 로 사용하도록 설정합니다.</p>
<p><strong><code>src/app.module.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GraphQLModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/graphql&#x27;</span>;

<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title class_">GraphQLModule</span>.<span class="hljs-title function_">forRoot</span>({
      <span class="hljs-attr">typePaths</span>: [<span class="hljs-string">&#x27;./**/*.graphql&#x27;</span>],
    }),
  ],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<p>Schema를 만들었으니 이제 Resolver를 만들어 봅시다.</p>
<p><code>src</code> 폴더 안에 <code>models</code> 폴더를 생성하고, <code>src/models/person.resolver.ts</code>와 <code>src/models/person.module.ts</code> 파일을 작성합니다.<br>
아직 데이터베이스와 연결하지 않았기 때문에 <code>getAllPerson</code> Query 요청이 오면 아래와 같은 데이터를 반환하도록 작성합니다.</p>
<p><strong><code>src/models/person.resolver.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Query</span>, <span class="hljs-title class_">Resolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/graphql&#x27;</span>;

<span class="hljs-meta">@Resolver</span>(<span class="hljs-string">&#x27;Person&#x27;</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonResolver</span> {
  <span class="hljs-meta">@Query</span>()
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAllPerson</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> [
      {
        <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;1&#x27;</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;이규혁&#x27;</span>,
        <span class="hljs-attr">number</span>: <span class="hljs-string">&#x27;+82 10-1234-5678&#x27;</span>,
        <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;lee@kyuhyuk.kr&#x27;</span>,
      },
      { <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;변정원&#x27;</span>, <span class="hljs-attr">number</span>: <span class="hljs-string">&#x27;+82 10-8765-4321&#x27;</span> },
    ];
  }
}
</code></pre>
<p><strong><code>src/models/person.module.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PersonResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./person.resolver&#x27;</span>;

<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">PersonResolver</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonModule</span> {}
</code></pre>
<p><code>src/app.module.ts</code>에 <code>PersonModule</code>를 추가합니다.</p>
<p><strong><code>src/app.module.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GraphQLModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PersonModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./models/person.module&#x27;</span>;

<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title class_">GraphQLModule</span>.<span class="hljs-title function_">forRoot</span>({
      <span class="hljs-attr">typePaths</span>: [<span class="hljs-string">&#x27;./**/*.graphql&#x27;</span>],
    }),
    <span class="hljs-title class_">PersonModule</span>,
  ],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<p><code>npm run start:dev</code>를 실행하고 <a href="http://localhost:8080/graphql">http://localhost:8080/graphql</a>에 접속합니다.<br>
GraphQL Playground가 브라우저에 출력되면, 아래와 같이 입력하여 실행해봅니다.</p>
<p>우리가 의도한 대로 동작하는 것을 확인할 수 있습니다.<br>
<img src="/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_2.png" alt="GraphQL Playground"></p>
<h1>데이터베이스와 연결</h1>
<p>이 글에서는 MongoDB를 GraphQL과 연결하도록 하겠습니다.<br>
<a href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a>에접속하여 MongoDB Community Server를 다운로드하고 설치합니다.</p>
<p>간편하게 MongoDB를 사용하기 위해서 <a href="https://robomongo.org">Robo 3T</a>를 사용하도록 하겠습니다.<br>
아래와 같이 데이터 몇 개를 삽입하였습니다.<br>
<img src="/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_3.png" alt="Robo 3T - Insert Document"></p>
<p>Nest.js 프로젝트에 아래의 패키지를 추가합니다.</p>
<pre><code class="language-bash">npm install --save mongoose
</code></pre>
<p><code>src/database.providers.ts</code>와 <code>src/database.module.ts</code> 파일을 작성하여, 데이터베이스와의 연결을 설정합니다.</p>
<p><strong><code>src/database.providers.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> mongoose <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DATABASE_NAME</span> = <span class="hljs-string">&#x27;GraphQL&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> databaseProviders = [
  {
    <span class="hljs-attr">provide</span>: <span class="hljs-string">&#x27;DATABASE_CONNECTION&#x27;</span>,
    <span class="hljs-attr">useFactory</span>: (): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">typeof</span> mongoose&gt; =&gt;
      mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">`mongodb://localhost/<span class="hljs-subst">${DATABASE_NAME}</span>`</span>),
  },
];
</code></pre>
<p><strong><code>src/database.module.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;
<span class="hljs-keyword">import</span> { databaseProviders } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./database.providers&#x27;</span>;

<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">providers</span>: [...databaseProviders],
  <span class="hljs-attr">exports</span>: [...databaseProviders],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseModule</span> {}
</code></pre>
<p>Mongoose를 사용하면 모든 것이 Schema에서 파생됩니다.<br>
<code>src</code>에 <code>schemas</code> 폴더를 만들고, <code>person.schema.ts</code> 파일을 작성합니다.</p>
<p><strong><code>src/schemas/person.schema.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Field</span>, <span class="hljs-title class_">ObjectType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/graphql&#x27;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> mongoose <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Document</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">PersonSchema</span> = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">_id</span>: { <span class="hljs-attr">type</span>: mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>, <span class="hljs-attr">auto</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">number</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-title class_">String</span>,
});

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Document</span> {
  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">_id</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">number</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p>위에서 만든 <code>PersonSchema</code>를 사용하여 Model Provider를 만들어봅시다.<br>
아래와 같이 <code>person.providers.ts</code> 파일을 작성합니다.</p>
<p><strong><code>src/models/person.providers.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Connection</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PersonSchema</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../schemas/person.schema&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">PersonProviders</span> = [
  {
    <span class="hljs-attr">provide</span>: <span class="hljs-string">&#x27;PERSON_MODEL&#x27;</span>,
    <span class="hljs-attr">useFactory</span>: <span class="hljs-function">(<span class="hljs-params">connection: Connection</span>) =&gt;</span> connection.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Person&#x27;</span>, <span class="hljs-title class_">PersonSchema</span>, <span class="hljs-string">&#x27;Person&#x27;</span>),
    <span class="hljs-attr">inject</span>: [<span class="hljs-string">&#x27;DATABASE_CONNECTION&#x27;</span>],
  },
];
</code></pre>
<blockquote>
<p><code>PERSON_MODEL</code>과 <code>DATABASE_CONNECTION</code>은 <code>constants.ts</code> 파일을 따로 만들어 분리하여 보관하는 것을권장합니다.</p>
</blockquote>
<p>이제 <code>@Inject()</code>를 사용하여 <code>PersonService</code>에 <code>PERSON_MODEL</code>를 추가합니다.<br>
<code>src/models/person.service.ts</code> 파일을 아래와 같이 작성합니다.</p>
<p><strong><code>src/models/person.service.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Model</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span>, <span class="hljs-title class_">Inject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Person</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../schemas/person.schema&#x27;</span>;

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonService</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@Inject</span>(<span class="hljs-string">&#x27;PERSON_MODEL&#x27;</span>)
    <span class="hljs-keyword">private</span> personModel: Model&lt;Person&gt;
  </span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">findAll</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Person</span>[]&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">personModel</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">exec</span>();
  }
}
</code></pre>
<p><code>src/models/person.module.ts</code>에 <code>DatabaseModule</code>과 <code>PersonService</code>, <code>PersonProviders</code>를 추가합니다.</p>
<p><strong><code>src/models/person.module.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DatabaseModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../database.module&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PersonProviders</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./person.providers&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PersonResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./person.resolver&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PersonService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./person.service&#x27;</span>;

<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">DatabaseModule</span>],
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">PersonResolver</span>, <span class="hljs-title class_">PersonService</span>, ...<span class="hljs-title class_">PersonProviders</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonModule</span> {}
</code></pre>
<p>기존에 작성했던 <code>src/models/person.resolver.ts</code>를 아래와 같이 수정하여 실제 데이터베이스에 있는 데이터를 가져오도록 구현합니다.</p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Query</span>, <span class="hljs-title class_">Resolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Person</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;src/schemas/person.schema&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PersonService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./person.service&#x27;</span>;

<span class="hljs-meta">@Resolver</span>(<span class="hljs-string">&#x27;Person&#x27;</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonResolver</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> personService: PersonService</span>) {}

  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-title class_">Person</span>])
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAllPerson</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">personService</span>.<span class="hljs-title function_">findAll</span>();
  }
}
</code></pre>
<p>켜져 있는 NestJS 서버를 중단하고, <code>npm run start:dev</code>를 다시 실행한 뒤 <a href="http://localhost:8080/graphql">http://localhost:8080/graphql</a>에 접속합니다.</p>
<p>Query를 요청하면, 아래와 같이 MongoDB에 있는 데이터가 정상적으로 나오고 있음을 확인할 수 있습니다.<br>
<img src="/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_4.png" alt="GraphQL Playground"></p>
<p>Query를 구현했으니 이제 Mutation을 구현해봅시다.</p>
<p><code>graphql/person.graphql</code>에 아래와 같이 Mutation을 추가합니다.</p>
<p><strong><code>graphql/person.graphql</code> :</strong></p>
<pre><code class="language-graphql"><span class="hljs-keyword">type</span> Person <span class="hljs-punctuation">{</span>
  <span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">!</span>
  <span class="hljs-symbol">name</span><span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">!</span>
  <span class="hljs-symbol">number</span><span class="hljs-punctuation">:</span> String
  <span class="hljs-symbol">email</span><span class="hljs-punctuation">:</span> String
<span class="hljs-punctuation">}</span>

<span class="hljs-keyword">input</span> CreatePersonInput <span class="hljs-punctuation">{</span>
  <span class="hljs-symbol">name</span><span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">!</span>
  <span class="hljs-symbol">number</span><span class="hljs-punctuation">:</span> String
  <span class="hljs-symbol">email</span><span class="hljs-punctuation">:</span> String
<span class="hljs-punctuation">}</span>

<span class="hljs-keyword">type</span> <span class="hljs-keyword">Query</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-symbol">getAllPerson</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>Person<span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-keyword">type</span> <span class="hljs-keyword">Mutation</span> <span class="hljs-punctuation">{</span>
  addPerson<span class="hljs-punctuation">(</span><span class="hljs-symbol">person</span><span class="hljs-punctuation">:</span> CreatePersonInput<span class="hljs-punctuation">)</span><span class="hljs-punctuation">:</span> Person
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>src/schemas/person.schema.ts</code>에도 <code>CreatePersonInput</code>을 추가합니다.</p>
<p><strong><code>src/schemas/person.schema.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Field</span>, <span class="hljs-title class_">ObjectType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/graphql&#x27;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> mongoose <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Document</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">PersonSchema</span> = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">_id</span>: { <span class="hljs-attr">type</span>: mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>, <span class="hljs-attr">auto</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">number</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-title class_">String</span>,
});

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Document</span> {
  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">_id</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">number</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreatePersonInput</span> {
  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">number</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><code>PersonService</code>에 <code>addPerson()</code>을 추가합니다.</p>
<p><strong><code>src/models/person.service.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Model</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span>, <span class="hljs-title class_">Inject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CreatePersonInput</span>, <span class="hljs-title class_">Person</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../schemas/person.schema&#x27;</span>;

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonService</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@Inject</span>(<span class="hljs-string">&#x27;PERSON_MODEL&#x27;</span>)
    <span class="hljs-keyword">private</span> personModel: Model&lt;Person&gt;
  </span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">findAll</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Person</span>[]&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">personModel</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">exec</span>();
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">addPerson</span>(<span class="hljs-attr">person</span>: <span class="hljs-title class_">CreatePersonInput</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Person</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">personModel</span>.<span class="hljs-title function_">create</span>(person);
  }
}
</code></pre>
<p><code>PersonResolver</code>에 <code>addPerson</code> Mutation을 추가합니다.</p>
<p><strong><code>src/models/person.resolver.ts</code> :</strong></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Args</span>, <span class="hljs-title class_">Mutation</span>, <span class="hljs-title class_">Query</span>, <span class="hljs-title class_">Resolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CreatePersonInput</span>, <span class="hljs-title class_">Person</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../schemas/person.schema&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PersonService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./person.service&#x27;</span>;

<span class="hljs-meta">@Resolver</span>(<span class="hljs-string">&#x27;Person&#x27;</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonResolver</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> personService: PersonService</span>) {}

  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-title class_">Person</span>])
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAllPerson</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">personService</span>.<span class="hljs-title function_">findAll</span>();
  }

  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Person</span>)
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">addPerson</span>(<span class="hljs-params"><span class="hljs-meta">@Args</span>(<span class="hljs-string">&#x27;person&#x27;</span>) person: CreatePersonInput</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">personService</span>.<span class="hljs-title function_">addPerson</span>(person);
  }
}
</code></pre>
<p>켜져 있는 NestJS 서버를 중단하고, <code>npm run start:dev</code>를 다시 실행한 뒤 <a href="http://localhost:8080/graphql">http://localhost:8080/graphql</a>에 접속합니다.</p>
<p>Mutation을 요청하면, 아래와 같이 MongoDB에 정상적으로 데이터가 삽입된 것을 확인할 수 있습니다.<br>
<img src="/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_5.png" alt="GraphQL Playground"><br>
<img src="/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_6.png" alt="Robo 3T - Documents"></p>
</div></article></main><footer class="c-cpkrrK"><div class="c-fiqONv">© <!-- -->2023</div><div class="c-bHyrwK"><div class="c-iUFgVP">Kh.</div><div class="c-cshSRb">KyuHyuk Lee</div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"excerpt":" Nest.js 에 GraphQL 서버를 구축하는 방법을 정리해보았습니다. Nest.js 프로젝트 생성 npm init 를 사용하여 아래와 같이 package.json 을 생성합니다. 아래의 패키지를 설치합니다. npm install --save @nestjs/axios @nestjs/","url":"/article/graphql/2021/09/16/Building-a-GraphQL-Server-with-NestJS","frontmatter":{"title":"Nest.js로 GraphQL 서버 구축하기","date":"2021-09-16 00:12:10","category":"GraphQL"},"content":"\r\n[Nest.js](https://nestjs.com)에 GraphQL 서버를 구축하는 방법을 정리해보았습니다.\r\n\r\n# Nest.js 프로젝트 생성\r\n\r\n`npm init`를 사용하여 아래와 같이 `package.json`을 생성합니다.  \r\n![Create NestJS Project](/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_1.png)\r\n\r\n아래의 패키지를 설치합니다.\r\n\r\n```bash\r\nnpm install --save @nestjs/axios @nestjs/common @nestjs/core @nestjs/platform-express reflect-metadata rxjs\r\nnpm install --save-dev @nestjs/cli @nestjs/schematics @types/express @types/node ts-loader ts-node tsconfig-paths typescript\r\n```\r\n\r\n`package.json`에 `\"main\": \"index.js\"` 행을 삭제하고 아래 내용을 추가합니다.\r\n\r\n```json\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"build\": \"nest build\",\r\n    \"start\": \"nest start\",\r\n    \"start:dev\": \"NODE_ENV=development nest start --watch\",\r\n    \"start:debug\": \"NODE_ENV=development nest start --debug --watch\",\r\n    \"start:prod\": \"npm run build \u0026\u0026 NODE_ENV=production node dist/main\"\r\n  },\r\n```\r\n\r\n`nest-cli.json`, `tsconfig.build.json`, `tsconfig.json`을 아래와 같이 작성하여 저장합니다.\r\n\r\n**`nest-cli.json` :**\r\n\r\n```json\r\n{\r\n  \"collection\": \"@nestjs/schematics\",\r\n  \"sourceRoot\": \"src\"\r\n}\r\n```\r\n\r\n**`tsconfig.build.json` :**\r\n\r\n```json\r\n{\r\n  \"extends\": \"./tsconfig.json\",\r\n  \"exclude\": [\"node_modules\", \"dist\", \"test\", \"**/*spec.ts\"]\r\n}\r\n```\r\n\r\n**`tsconfig.json` :**\r\n\r\n```json\r\n{\r\n  \"compilerOptions\": {\r\n    \"module\": \"commonjs\",\r\n    \"declaration\": true,\r\n    \"removeComments\": true,\r\n    \"emitDecoratorMetadata\": true,\r\n    \"experimentalDecorators\": true,\r\n    \"allowSyntheticDefaultImports\": true,\r\n    \"target\": \"es2017\",\r\n    \"sourceMap\": true,\r\n    \"outDir\": \"./dist\",\r\n    \"baseUrl\": \"./\",\r\n    \"incremental\": true,\r\n    \"skipLibCheck\": true\r\n  }\r\n}\r\n```\r\n\r\n# Nest.js 프로젝트에 GraphQL 추가 및 설정\r\n\r\n아래의 패키지를 설치합니다.\r\n\r\n```bash\r\nnpm install --save @nestjs/graphql apollo-server-express graphql\r\n```\r\n\r\n`src` 폴더를 만들고 `src/app.module.ts`와 `src/main.ts`를 생성합니다.\r\n\r\n**`src/app.module.ts` :**\r\n\r\n```typescript\r\nimport { Module } from '@nestjs/common';\r\nimport { GraphQLModule } from '@nestjs/graphql';\r\n\r\n@Module({\r\n  imports: [GraphQLModule.forRoot({})],\r\n})\r\nexport class AppModule {}\r\n```\r\n\r\n위의 코드에서 `forRoot()`에 [여러 설정](https://www.apollographql.com/docs/apollo-server/v2/api/apollo-server.html#constructor-options-lt-ApolloServer-gt)을넣을 수 있습니다. [설정값](https://www.apollographql.com/docs/apollo-server/v2/api/apollo-server.html#constructor-options-lt-ApolloServer-gt)은기본 Apollo 인스턴스로 전달됩니다.  \r\n예를 들어 `playground`와 `debug`를 끄려면 다음과 같이 사용할 수 있습니다.\r\n\r\n```typescript\r\nimport { Module } from '@nestjs/common';\r\nimport { GraphQLModule } from '@nestjs/graphql';\r\n\r\n@Module({\r\n  imports: [\r\n    GraphQLModule.forRoot({\r\n      debug: false,\r\n      playground: false,\r\n    }),\r\n  ],\r\n})\r\nexport class AppModule {}\r\n```\r\n\r\n**`src/main.ts` :**\r\n\r\n```typescript\r\nimport { NestFactory } from '@nestjs/core';\r\nimport { AppModule } from './app.module';\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n  await app.listen(8080);\r\n}\r\nbootstrap();\r\n```\r\n\r\n# Resolver, Schema 생성\r\n\r\n아마 위의 코드를 모두 작성하고 `npm run start:dev`를 하면 `UnhandledPromiseRejectionWarning: Error: Apollo Server requires either an existing schema, modules or typeDefs`라고 오류가 발생할 것입니다.\r\n\r\n이 오류가 발생하는 이유는 Resolver, Schema가 없어서 발생하는 오류입니다.  \r\n여기서 말하는 Resolver는 GraphQL 작업(Query, Mutation, Subscription)을 데이터로 변환하기 위해 사용됩니다.\r\n\r\nSchema는 아래와 같이 정의할 수 있습니다. 간단하게 주소록에 필요한 Schema를 작성해보겠습니다.\r\n\r\n`graphql` 폴더를 생성하고 `person.graphql` 파일을 생성합니다.\r\n\r\n**`graphql/person.graphql` :**\r\n\r\n```graphql\r\ntype Person {\r\n  id: String!\r\n  name: String!\r\n  number: String\r\n  email: String\r\n}\r\n\r\ntype Query {\r\n  getAllPerson: [Person]\r\n}\r\n```\r\n\r\nGraphQL에서 사용되는 Schema와 Type이 궁금하다면 [https://graphql.org/learn/schema](https://graphql.org/learn/schema/)를 읽어보세요.\r\n\r\n그리고 `src/app.module.ts`에 `typePaths`를 추가하여 `.graphql` 확장자를 가진 파일을 GraphQL의 Schema 로 사용하도록 설정합니다.\r\n\r\n**`src/app.module.ts` :**\r\n\r\n```typescript\r\nimport { Module } from '@nestjs/common';\r\nimport { GraphQLModule } from '@nestjs/graphql';\r\n\r\n@Module({\r\n  imports: [\r\n    GraphQLModule.forRoot({\r\n      typePaths: ['./**/*.graphql'],\r\n    }),\r\n  ],\r\n})\r\nexport class AppModule {}\r\n```\r\n\r\nSchema를 만들었으니 이제 Resolver를 만들어 봅시다.\r\n\r\n`src` 폴더 안에 `models` 폴더를 생성하고, `src/models/person.resolver.ts`와 `src/models/person.module.ts` 파일을 작성합니다.  \r\n아직 데이터베이스와 연결하지 않았기 때문에 `getAllPerson` Query 요청이 오면 아래와 같은 데이터를 반환하도록 작성합니다.\r\n\r\n**`src/models/person.resolver.ts` :**\r\n\r\n```typescript\r\nimport { Query, Resolver } from '@nestjs/graphql';\r\n\r\n@Resolver('Person')\r\nexport class PersonResolver {\r\n  @Query()\r\n  async getAllPerson() {\r\n    return [\r\n      {\r\n        id: '1',\r\n        name: '이규혁',\r\n        number: '+82 10-1234-5678',\r\n        email: 'lee@kyuhyuk.kr',\r\n      },\r\n      { id: '2', name: '변정원', number: '+82 10-8765-4321' },\r\n    ];\r\n  }\r\n}\r\n```\r\n\r\n**`src/models/person.module.ts` :**\r\n\r\n```typescript\r\nimport { Module } from '@nestjs/common';\r\nimport { PersonResolver } from './person.resolver';\r\n\r\n@Module({\r\n  providers: [PersonResolver],\r\n})\r\nexport class PersonModule {}\r\n```\r\n\r\n`src/app.module.ts`에 `PersonModule`를 추가합니다.\r\n\r\n**`src/app.module.ts` :**\r\n\r\n```typescript\r\nimport { Module } from '@nestjs/common';\r\nimport { GraphQLModule } from '@nestjs/graphql';\r\nimport { PersonModule } from './models/person.module';\r\n\r\n@Module({\r\n  imports: [\r\n    GraphQLModule.forRoot({\r\n      typePaths: ['./**/*.graphql'],\r\n    }),\r\n    PersonModule,\r\n  ],\r\n})\r\nexport class AppModule {}\r\n```\r\n\r\n`npm run start:dev`를 실행하고 [http://localhost:8080/graphql](http://localhost:8080/graphql)에 접속합니다.  \r\nGraphQL Playground가 브라우저에 출력되면, 아래와 같이 입력하여 실행해봅니다.\r\n\r\n우리가 의도한 대로 동작하는 것을 확인할 수 있습니다.  \r\n![GraphQL Playground](/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_2.png)\r\n\r\n# 데이터베이스와 연결\r\n\r\n이 글에서는 MongoDB를 GraphQL과 연결하도록 하겠습니다.  \r\n[https://www.mongodb.com/try/download/community](https://www.mongodb.com/try/download/community)에접속하여 MongoDB Community Server를 다운로드하고 설치합니다.\r\n\r\n간편하게 MongoDB를 사용하기 위해서 [Robo 3T](https://robomongo.org)를 사용하도록 하겠습니다.  \r\n아래와 같이 데이터 몇 개를 삽입하였습니다.  \r\n![Robo 3T - Insert Document](/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_3.png)\r\n\r\nNest.js 프로젝트에 아래의 패키지를 추가합니다.\r\n\r\n```bash\r\nnpm install --save mongoose\r\n```\r\n\r\n`src/database.providers.ts`와 `src/database.module.ts` 파일을 작성하여, 데이터베이스와의 연결을 설정합니다.\r\n\r\n**`src/database.providers.ts` :**\r\n\r\n```typescript\r\nimport * as mongoose from 'mongoose';\r\n\r\nconst DATABASE_NAME = 'GraphQL';\r\n\r\nexport const databaseProviders = [\r\n  {\r\n    provide: 'DATABASE_CONNECTION',\r\n    useFactory: (): Promise\u003ctypeof mongoose\u003e =\u003e\r\n      mongoose.connect(`mongodb://localhost/${DATABASE_NAME}`),\r\n  },\r\n];\r\n```\r\n\r\n**`src/database.module.ts` :**\r\n\r\n```typescript\r\nimport { Module } from '@nestjs/common';\r\nimport { databaseProviders } from './database.providers';\r\n\r\n@Module({\r\n  providers: [...databaseProviders],\r\n  exports: [...databaseProviders],\r\n})\r\nexport class DatabaseModule {}\r\n```\r\n\r\nMongoose를 사용하면 모든 것이 Schema에서 파생됩니다.  \r\n`src`에 `schemas` 폴더를 만들고, `person.schema.ts` 파일을 작성합니다.\r\n\r\n**`src/schemas/person.schema.ts` :**\r\n\r\n```typescript\r\nimport { Field, ObjectType } from '@nestjs/graphql';\r\nimport * as mongoose from 'mongoose';\r\nimport { Document } from 'mongoose';\r\n\r\nexport const PersonSchema = new mongoose.Schema({\r\n  _id: { type: mongoose.Schema.Types.ObjectId, auto: true },\r\n  name: String,\r\n  number: String,\r\n  email: String,\r\n});\r\n\r\n@ObjectType()\r\nexport class Person extends Document {\r\n  @Field()\r\n  _id: string;\r\n\r\n  @Field()\r\n  name: string;\r\n\r\n  @Field()\r\n  number: string;\r\n\r\n  @Field()\r\n  email: string;\r\n}\r\n```\r\n\r\n위에서 만든 `PersonSchema`를 사용하여 Model Provider를 만들어봅시다.  \r\n아래와 같이 `person.providers.ts` 파일을 작성합니다.\r\n\r\n**`src/models/person.providers.ts` :**\r\n\r\n```typescript\r\nimport { Connection } from 'mongoose';\r\nimport { PersonSchema } from '../schemas/person.schema';\r\n\r\nexport const PersonProviders = [\r\n  {\r\n    provide: 'PERSON_MODEL',\r\n    useFactory: (connection: Connection) =\u003e connection.model('Person', PersonSchema, 'Person'),\r\n    inject: ['DATABASE_CONNECTION'],\r\n  },\r\n];\r\n```\r\n\r\n\u003e `PERSON_MODEL`과 `DATABASE_CONNECTION`은 `constants.ts` 파일을 따로 만들어 분리하여 보관하는 것을권장합니다.\r\n\r\n이제 `@Inject()`를 사용하여 `PersonService`에 `PERSON_MODEL`를 추가합니다.  \r\n`src/models/person.service.ts` 파일을 아래와 같이 작성합니다.\r\n\r\n**`src/models/person.service.ts` :**\r\n\r\n```typescript\r\nimport { Model } from 'mongoose';\r\nimport { Injectable, Inject } from '@nestjs/common';\r\nimport { Person } from '../schemas/person.schema';\r\n\r\n@Injectable()\r\nexport class PersonService {\r\n  constructor(\r\n    @Inject('PERSON_MODEL')\r\n    private personModel: Model\u003cPerson\u003e\r\n  ) {}\r\n\r\n  async findAll(): Promise\u003cPerson[]\u003e {\r\n    return this.personModel.find().exec();\r\n  }\r\n}\r\n```\r\n\r\n`src/models/person.module.ts`에 `DatabaseModule`과 `PersonService`, `PersonProviders`를 추가합니다.\r\n\r\n**`src/models/person.module.ts` :**\r\n\r\n```typescript\r\nimport { Module } from '@nestjs/common';\r\nimport { DatabaseModule } from '../database.module';\r\nimport { PersonProviders } from './person.providers';\r\nimport { PersonResolver } from './person.resolver';\r\nimport { PersonService } from './person.service';\r\n\r\n@Module({\r\n  imports: [DatabaseModule],\r\n  providers: [PersonResolver, PersonService, ...PersonProviders],\r\n})\r\nexport class PersonModule {}\r\n```\r\n\r\n기존에 작성했던 `src/models/person.resolver.ts`를 아래와 같이 수정하여 실제 데이터베이스에 있는 데이터를 가져오도록 구현합니다.\r\n\r\n```typescript\r\nimport { Query, Resolver } from '@nestjs/graphql';\r\nimport { Person } from 'src/schemas/person.schema';\r\nimport { PersonService } from './person.service';\r\n\r\n@Resolver('Person')\r\nexport class PersonResolver {\r\n  constructor(private personService: PersonService) {}\r\n\r\n  @Query(() =\u003e [Person])\r\n  async getAllPerson() {\r\n    return await this.personService.findAll();\r\n  }\r\n}\r\n```\r\n\r\n켜져 있는 NestJS 서버를 중단하고, `npm run start:dev`를 다시 실행한 뒤 [http://localhost:8080/graphql](http://localhost:8080/graphql)에 접속합니다.\r\n\r\nQuery를 요청하면, 아래와 같이 MongoDB에 있는 데이터가 정상적으로 나오고 있음을 확인할 수 있습니다.  \r\n![GraphQL Playground](/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_4.png)\r\n\r\nQuery를 구현했으니 이제 Mutation을 구현해봅시다.\r\n\r\n`graphql/person.graphql`에 아래와 같이 Mutation을 추가합니다.\r\n\r\n**`graphql/person.graphql` :**\r\n\r\n```graphql\r\ntype Person {\r\n  id: String!\r\n  name: String!\r\n  number: String\r\n  email: String\r\n}\r\n\r\ninput CreatePersonInput {\r\n  name: String!\r\n  number: String\r\n  email: String\r\n}\r\n\r\ntype Query {\r\n  getAllPerson: [Person]\r\n}\r\n\r\ntype Mutation {\r\n  addPerson(person: CreatePersonInput): Person\r\n}\r\n```\r\n\r\n`src/schemas/person.schema.ts`에도 `CreatePersonInput`을 추가합니다.\r\n\r\n**`src/schemas/person.schema.ts` :**\r\n\r\n```typescript\r\nimport { Field, ObjectType } from '@nestjs/graphql';\r\nimport * as mongoose from 'mongoose';\r\nimport { Document } from 'mongoose';\r\n\r\nexport const PersonSchema = new mongoose.Schema({\r\n  _id: { type: mongoose.Schema.Types.ObjectId, auto: true },\r\n  name: String,\r\n  number: String,\r\n  email: String,\r\n});\r\n\r\n@ObjectType()\r\nexport class Person extends Document {\r\n  @Field()\r\n  _id: string;\r\n\r\n  @Field()\r\n  name: string;\r\n\r\n  @Field()\r\n  number: string;\r\n\r\n  @Field()\r\n  email: string;\r\n}\r\n\r\n@ObjectType()\r\nexport class CreatePersonInput {\r\n  @Field()\r\n  name: string;\r\n\r\n  @Field()\r\n  number: string;\r\n\r\n  @Field()\r\n  email: string;\r\n}\r\n```\r\n\r\n`PersonService`에 `addPerson()`을 추가합니다.\r\n\r\n**`src/models/person.service.ts` :**\r\n\r\n```typescript\r\nimport { Model } from 'mongoose';\r\nimport { Injectable, Inject } from '@nestjs/common';\r\nimport { CreatePersonInput, Person } from '../schemas/person.schema';\r\n\r\n@Injectable()\r\nexport class PersonService {\r\n  constructor(\r\n    @Inject('PERSON_MODEL')\r\n    private personModel: Model\u003cPerson\u003e\r\n  ) {}\r\n\r\n  async findAll(): Promise\u003cPerson[]\u003e {\r\n    return this.personModel.find().exec();\r\n  }\r\n\r\n  async addPerson(person: CreatePersonInput): Promise\u003cPerson\u003e {\r\n    return this.personModel.create(person);\r\n  }\r\n}\r\n```\r\n\r\n`PersonResolver`에 `addPerson` Mutation을 추가합니다.\r\n\r\n**`src/models/person.resolver.ts` :**\r\n\r\n```typescript\r\nimport { Args, Mutation, Query, Resolver } from '@nestjs/graphql';\r\nimport { CreatePersonInput, Person } from '../schemas/person.schema';\r\nimport { PersonService } from './person.service';\r\n\r\n@Resolver('Person')\r\nexport class PersonResolver {\r\n  constructor(private personService: PersonService) {}\r\n\r\n  @Query(() =\u003e [Person])\r\n  async getAllPerson() {\r\n    return await this.personService.findAll();\r\n  }\r\n\r\n  @Mutation(() =\u003e Person)\r\n  async addPerson(@Args('person') person: CreatePersonInput) {\r\n    return await this.personService.addPerson(person);\r\n  }\r\n}\r\n```\r\n\r\n켜져 있는 NestJS 서버를 중단하고, `npm run start:dev`를 다시 실행한 뒤 [http://localhost:8080/graphql](http://localhost:8080/graphql)에 접속합니다.\r\n\r\nMutation을 요청하면, 아래와 같이 MongoDB에 정상적으로 데이터가 삽입된 것을 확인할 수 있습니다.  \r\n![GraphQL Playground](/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_5.png)  \r\n![Robo 3T - Documents](/assets/image/2021-09-16-Building-a-GraphQL-Server-with-NestJS/2021-09-16-Building-a-GraphQL-Server-with-NestJS_6.png)\r\n"},"__N_SSG":true},"page":"/article/[category]/[year]/[month]/[day]/[slug]","query":{"category":"graphql","year":"2021","month":"09","day":"16","slug":"Building-a-GraphQL-Server-with-NestJS"},"buildId":"sFagy2B10ejf-tz-1N1o9","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>