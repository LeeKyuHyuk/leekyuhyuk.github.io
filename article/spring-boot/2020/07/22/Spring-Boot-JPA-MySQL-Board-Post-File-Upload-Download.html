<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta property="og:image" content="https://kyuhyuk.kr/thumbnail.png"/><title>[Spring Boot] 게시판 구현 하기 (4) - 파일 업로드 &amp; 다운로드</title><meta name="author" content="KyuHyuk Lee"/><meta name="generator" content="KyuHyuk Lee"/><meta name="description" content=" 앞의 글 에 서 글을 수정하고 삭제하는 기능을 만들었습니다. 이번 시간에는 파일을 업로드하고 다운로드하는 기능을 구현해보겠습니다. 파일 업로드 구현하기 파일 업로드를 구현하기 전에, 어떤 과정으로 동작하고 어떻게 구현할 것인지 미리 생각해봅시다. 아래는 파일 업로드의 과정입니다. 우리"/><meta itemProp="url" content="https://kyuhyuk.kr/article/spring-boot/2020/07/22/Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download"/><meta itemProp="headline" content="[Spring Boot] 게시판 구현 하기 (4) - 파일 업로드 &amp; 다운로드"/><meta property="og:type" content="article"/><meta property="og:url" content="https://kyuhyuk.kr/article/spring-boot/2020/07/22/Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download"/><meta property="og:title" content="[Spring Boot] 게시판 구현 하기 (4) - 파일 업로드 &amp; 다운로드"/><meta property="og:description" content=" 앞의 글 에 서 글을 수정하고 삭제하는 기능을 만들었습니다. 이번 시간에는 파일을 업로드하고 다운로드하는 기능을 구현해보겠습니다. 파일 업로드 구현하기 파일 업로드를 구현하기 전에, 어떤 과정으로 동작하고 어떻게 구현할 것인지 미리 생각해봅시다. 아래는 파일 업로드의 과정입니다. 우리"/><meta property="og:site_name" content="KyuHyuk Blog"/><meta property="og:locale" content="ko_KR"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/4e0666c6da09e1ee.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4e0666c6da09e1ee.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c2a527101433f11d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c2a527101433f11d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-fc7d2f0e2098927e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2774ecbb7f55613d.js" defer=""></script><script src="/_next/static/chunks/869-82e19047d92f6e30.js" defer=""></script><script src="/_next/static/chunks/895-531271280742d591.js" defer=""></script><script src="/_next/static/chunks/pages/article/%5Bcategory%5D/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bslug%5D-e1207b3501068a48.js" defer=""></script><script src="/_next/static/Dsgna1Ug9ERZ37IDpNGla/_buildManifest.js" defer=""></script><script src="/_next/static/Dsgna1Ug9ERZ37IDpNGla/_ssgManifest.js" defer=""></script><script src="/_next/static/Dsgna1Ug9ERZ37IDpNGla/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><header class="c-opBYf"><a href="https://kyuhyuk.kr"><div class="c-bHyrwK"><div class="c-uBnvQ">Kh.</div><div class="c-hehuMV">KyuHyuk Blog</div></div></a><ul class="c-bjkCdF"><li><a href="https://github.com/LeeKyuHyuk" class="c-hAoZGi"><span role="img" aria-label="github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></span></a></li><li><a href="https://linkedin.com/in/leekyuhyuk" class="c-hAoZGi"><span role="img" aria-label="linkedin" class="anticon anticon-linkedin"><svg viewBox="64 64 896 896" focusable="false" data-icon="linkedin" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM349.3 793.7H230.6V411.9h118.7v381.8zm-59.3-434a68.8 68.8 0 1168.8-68.8c-.1 38-30.9 68.8-68.8 68.8zm503.7 434H675.1V608c0-44.3-.8-101.2-61.7-101.2-61.7 0-71.2 48.2-71.2 98v188.9H423.7V411.9h113.8v52.2h1.6c15.8-30 54.5-61.7 112.3-61.7 120.2 0 142.3 79.1 142.3 181.9v209.4z"></path></svg></span></a></li><li><a href="mailto:lee@kyuhyuk.kr" class="c-hAoZGi"><span role="img" aria-label="mail" class="anticon anticon-mail"><svg viewBox="64 64 896 896" focusable="false" data-icon="mail" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-80.8 108.9L531.7 514.4c-7.8 6.1-18.7 6.1-26.5 0L189.6 268.9A7.2 7.2 0 01194 256h648.8a7.2 7.2 0 014.4 12.9z"></path></svg></span></a></li></ul></header><main class="c-jfcKOQ"><article><h1 class="c-fxvkZv"><a href="https://kyuhyuk.kr/article/spring-boot/2020/07/22/Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download">[Spring Boot] 게시판 구현 하기 (4) - 파일 업로드 &amp; 다운로드</a></h1><a href="https://kyuhyuk.kr/category/Spring-Boot" class="c-iosjjB">Spring Boot</a><time dateTime="2020-07-22 23:48:39" class="c-jYwCTI">Jul 23, 2020 08:48:39 AM</time><div id="post" class="c-dIcdES"><p><a href="https://kyuhyuk.kr/article/spring-boot/2020/07/21/Spring-Boot-JPA-MySQL-Board-Post-Update-Delete">앞의 글</a>에
서 글을 수정하고 삭제하는 기능을 만들었습니다.<br>
이번 시간에는 파일을 업로드하고 다운로드하는 기능을 구현해보겠습니다.</p>
<h2>파일 업로드 구현하기</h2>
<p>파일 업로드를 구현하기 전에, 어떤 과정으로 동작하고 어떻게 구현할 것인지 미리 생각해봅시다.<br>
아래는 파일 업로드의 과정입니다.<br>
<img src="/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_1.png" alt="File Upload Flow"><br>
우리가 구현할 것은 4가지입니다.</p>
<ul>
<li>'글쓰기' 화면에 파일 업로드 추가하기</li>
<li>업로드한 파일의 정보가 기록될 <code>file</code> 테이블 만들기 (Entity, Repository, DTO, Service 만들기)</li>
<li>업로드한 파일 정보의 고유 ID가 <code>board</code> 테이블에 기록되도록 변경하기</li>
<li><code>BoardController</code>의 <code>write()</code>에서 업로드한 파일이 서버에 저장되게 하고 <code>board</code>, <code>file</code> 테이블에 업
데이트 되도록 하기</li>
</ul>
<p>구현할 목록을 보면서 하나하나 진행해봅시다.</p>
<p>우선, <code>src\main\resources\templates\board</code>에 있는 <code>post.html</code>을 아래와 같이 수정합니다.<br>
기존 내용에 파일 선택하는 거와 <code>form</code>에 <code>enctype=&quot;multipart/form-data&quot;</code>만 추가하였습니다.</p>
<pre><code class="language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ko&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>게시판 - 글쓰기<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/webjars/bootstrap/4.5.0/css/bootstrap.min.css&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">th:insert</span>=<span class="hljs-string">&quot;common/header.html&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/post&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group row&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;inputTitle&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 col-form-label&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>제목<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;title&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inputTitle&quot;</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group row&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;inputAuthor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 col-form-label&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>작성자<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;author&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inputAuthor&quot;</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group row&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;inputContent&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 col-form-label&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>내용<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;content&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inputContent&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group row&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;inputFile&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 col-form-label&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>첨부 파일<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inputFile&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-file-input&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;customFile&quot;</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-file-label&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;customFile&quot;</span>&gt;</span>파일을 선택해 주세요.<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-auto mr-auto&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-auto&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;글쓰기&quot;</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/jquery/3.5.1/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/bootstrap/4.5.0/js/bootstrap.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">
      $(<span class="hljs-string">&#x27;.custom-file-input&#x27;</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        <span class="hljs-keyword">var</span> fileName = $(<span class="hljs-variable language_">this</span>).<span class="hljs-title function_">val</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;\\&#x27;</span>).<span class="hljs-title function_">pop</span>();
        $(<span class="hljs-variable language_">this</span>).<span class="hljs-title function_">siblings</span>(<span class="hljs-string">&#x27;.custom-file-label&#x27;</span>).<span class="hljs-title function_">addClass</span>(<span class="hljs-string">&#x27;selected&#x27;</span>).<span class="hljs-title function_">html</span>(fileName);
      });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>파일이 업로드되면 '업로드된 실제 파일명', '서버에 저장된 파일명', '파일이 서버에 저장된 위치'가 데이
터 베이스에 기록되게 프로그램을 작성할 것입니다.<br>
우선 업로드된 파일에 대한 데이터가 저장되게 Entity, Repository, DTO, Service를 만들어줍니다.</p>
<p>아래는 <code>domain.entity</code> 패키지의 <code>File</code> 클래스의 내용입니다.</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> kr.kyuhyuk.board.domain.entity;

<span class="hljs-keyword">import</span> lombok.AccessLevel;
<span class="hljs-keyword">import</span> lombok.Builder;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;

<span class="hljs-keyword">import</span> javax.persistence.Column;
<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">File</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(nullable = false)</span>
    <span class="hljs-keyword">private</span> String origFilename;

    <span class="hljs-meta">@Column(nullable = false)</span>
    <span class="hljs-keyword">private</span> String filename;

    <span class="hljs-meta">@Column(nullable = false)</span>
    <span class="hljs-keyword">private</span> String filePath;

    <span class="hljs-meta">@Builder</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">File</span><span class="hljs-params">(Long id, String origFilename, String filename, String filePath)</span> {
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.origFilename = origFilename;
        <span class="hljs-built_in">this</span>.filename = filename;
        <span class="hljs-built_in">this</span>.filePath = filePath;
    }
}
</code></pre>
<p>아래는 <code>domain.repository</code> 패키지의 <code>FileRepository</code> 인터페이스의 내용입니다.</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> kr.kyuhyuk.board.domain.repository;

<span class="hljs-keyword">import</span> kr.kyuhyuk.board.domain.entity.File;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FileRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;File, Long&gt; {
}
</code></pre>
<p>아래는 <code>dto</code> 패키지의 <code>FileDto</code> 클래스의 내용입니다.</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> kr.kyuhyuk.board.dto;

<span class="hljs-keyword">import</span> kr.kyuhyuk.board.domain.entity.File;
<span class="hljs-keyword">import</span> lombok.*;

<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileDto</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String origFilename;
    <span class="hljs-keyword">private</span> String filename;
    <span class="hljs-keyword">private</span> String filePath;

    <span class="hljs-keyword">public</span> File <span class="hljs-title function_">toEntity</span><span class="hljs-params">()</span> {
        <span class="hljs-type">File</span> <span class="hljs-variable">build</span> <span class="hljs-operator">=</span> File.builder()
                .id(id)
                .origFilename(origFilename)
                .filename(filename)
                .filePath(filePath)
                .build();
        <span class="hljs-keyword">return</span> build;
    }

    <span class="hljs-meta">@Builder</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FileDto</span><span class="hljs-params">(Long id, String origFilename, String filename, String filePath)</span> {
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.origFilename = origFilename;
        <span class="hljs-built_in">this</span>.filename = filename;
        <span class="hljs-built_in">this</span>.filePath = filePath;
    }
}
</code></pre>
<p>아래는 <code>service</code> 패키지의 <code>FileService</code> 클래스의 내용입니다.<br>
<code>saveFile()</code>은 업로드한 파일에 대한 정보를 기록하고, <code>getFile()</code>는 <code>id</code> 값을 사용하여 파일에 대한 정
보를 가져옵니다.</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> kr.kyuhyuk.board.service;

<span class="hljs-keyword">import</span> kr.kyuhyuk.board.domain.entity.File;
<span class="hljs-keyword">import</span> kr.kyuhyuk.board.domain.repository.FileRepository;
<span class="hljs-keyword">import</span> kr.kyuhyuk.board.dto.FileDto;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> javax.transaction.Transactional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileService</span> {
    <span class="hljs-keyword">private</span> FileRepository fileRepository;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FileService</span><span class="hljs-params">(FileRepository fileRepository)</span> {
        <span class="hljs-built_in">this</span>.fileRepository = fileRepository;
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">saveFile</span><span class="hljs-params">(FileDto fileDto)</span> {
        <span class="hljs-keyword">return</span> fileRepository.save(fileDto.toEntity()).getId();
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> FileDto <span class="hljs-title function_">getFile</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> fileRepository.findById(id).get();

        <span class="hljs-type">FileDto</span> <span class="hljs-variable">fileDto</span> <span class="hljs-operator">=</span> FileDto.builder()
                .id(id)
                .origFilename(file.getOrigFilename())
                .filename(file.getFilename())
                .filePath(file.getFilePath())
                .build();
        <span class="hljs-keyword">return</span> fileDto;
    }
}
</code></pre>
<p><code>domain.entity</code> 패키지에 있는 <code>Board</code>에 <code>fileId</code>를 추가합니다.<br>
첨부파일은 게시물에 필수로 들어가는 내용이 아니기 때문에, <code>nullable = false</code>는 넣지 않았습니다.</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> kr.kyuhyuk.board.domain.entity;

<span class="hljs-keyword">import</span> lombok.AccessLevel;
<span class="hljs-keyword">import</span> lombok.Builder;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.CreatedDate;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.LastModifiedDate;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.domain.support.AuditingEntityListener;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span>
<span class="hljs-meta">@EntityListeners(AuditingEntityListener.class)</span> <span class="hljs-comment">/* JPA에게 해당 Entity는 Auditiong 기능을 사용함을 알립니다. */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Board</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(length = 10, nullable = false)</span>
    <span class="hljs-keyword">private</span> String author;

    <span class="hljs-meta">@Column(length = 100, nullable = false)</span>
    <span class="hljs-keyword">private</span> String title;

    <span class="hljs-meta">@Column(columnDefinition = &quot;TEXT&quot;, nullable = false)</span>
    <span class="hljs-keyword">private</span> String content;

    <span class="hljs-meta">@Column</span>
    <span class="hljs-keyword">private</span> Long fileId;

    <span class="hljs-meta">@CreatedDate</span>
    <span class="hljs-meta">@Column(updatable = false)</span>
    <span class="hljs-keyword">private</span> LocalDateTime createdDate;

    <span class="hljs-meta">@LastModifiedDate</span>
    <span class="hljs-keyword">private</span> LocalDateTime modifiedDate;

    <span class="hljs-meta">@Builder</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Board</span><span class="hljs-params">(Long id, String author, String title, String content, Long fileId)</span> {
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.author = author;
        <span class="hljs-built_in">this</span>.title = title;
        <span class="hljs-built_in">this</span>.content = content;
        <span class="hljs-built_in">this</span>.fileId = fileId;
    }
}
</code></pre>
<p><code>dto</code> 패키지에 있는 <code>BoardDto</code> 클래스에도 <code>fileId</code>를 추가합니다.</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> kr.kyuhyuk.board.dto;

<span class="hljs-keyword">import</span> kr.kyuhyuk.board.domain.entity.Board;
<span class="hljs-keyword">import</span> lombok.*;

<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BoardDto</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String author;
    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> String content;
    <span class="hljs-keyword">private</span> Long fileId;
    <span class="hljs-keyword">private</span> LocalDateTime createdDate;
    <span class="hljs-keyword">private</span> LocalDateTime modifiedDate;

    <span class="hljs-keyword">public</span> Board <span class="hljs-title function_">toEntity</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Board</span> <span class="hljs-variable">build</span> <span class="hljs-operator">=</span> Board.builder()
                .id(id)
                .author(author)
                .title(title)
                .content(content)
                .fileId(fileId)
                .build();
        <span class="hljs-keyword">return</span> build;
    }

    <span class="hljs-meta">@Builder</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BoardDto</span><span class="hljs-params">(Long id, String author, String title, String content, Long fileId, LocalDateTime createdDate, LocalDateTime modifiedDate)</span> {
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.author = author;
        <span class="hljs-built_in">this</span>.title = title;
        <span class="hljs-built_in">this</span>.content = content;
        <span class="hljs-built_in">this</span>.fileId = fileId;
        <span class="hljs-built_in">this</span>.createdDate = createdDate;
        <span class="hljs-built_in">this</span>.modifiedDate = modifiedDate;
    }
}
</code></pre>
<p><code>service</code> 패키지에 있는 <code>BoardService</code> 클래스의 <code>getPost()</code>에도 <code>fileId</code>를 가져오게 수정합니다.</p>
<pre><code class="language-java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> BoardDto <span class="hljs-title function_">getPost</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-type">Board</span> <span class="hljs-variable">board</span> <span class="hljs-operator">=</span> boardRepository.findById(id).get();

    <span class="hljs-type">BoardDto</span> <span class="hljs-variable">boardDto</span> <span class="hljs-operator">=</span> BoardDto.builder()
            .id(board.getId())
            .author(board.getAuthor())
            .title(board.getTitle())
            .content(board.getContent())
            .fileId(board.getFileId())
            .createdDate(board.getCreatedDate())
            .build();
    <span class="hljs-keyword">return</span> boardDto;
}
</code></pre>
<p>파일이 업로드되면, MD5 체크섬의 값으로 서버에 저장되게 구현할 것입니다.<br>
문자열을 MD5 체크섬으로 변환하는 기능을 구현하기 위해, <code>util</code> 패키지를 만들고 <code>MD5Generator</code> 클래스
를 아래와 같이 작성합니다.</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> kr.kyuhyuk.board.util;

<span class="hljs-keyword">import</span> java.io.UnsupportedEncodingException;
<span class="hljs-keyword">import</span> java.security.MessageDigest;
<span class="hljs-keyword">import</span> java.security.NoSuchAlgorithmException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MD5Generator</span> {
    <span class="hljs-keyword">private</span> String result;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MD5Generator</span><span class="hljs-params">(String input)</span> <span class="hljs-keyword">throws</span> UnsupportedEncodingException, NoSuchAlgorithmException {
        <span class="hljs-type">MessageDigest</span> <span class="hljs-variable">mdMD5</span> <span class="hljs-operator">=</span> MessageDigest.getInstance(<span class="hljs-string">&quot;MD5&quot;</span>);
        mdMD5.update(input.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>));
        <span class="hljs-type">byte</span>[] md5Hash = mdMD5.digest();
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">hexMD5hash</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">for</span>(<span class="hljs-type">byte</span> b : md5Hash) {
            <span class="hljs-type">String</span> <span class="hljs-variable">hexString</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;%02x&quot;</span>, b);
            hexMD5hash.append(hexString);
        }
        result = hexMD5hash.toString();
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p>이제 모든 것이 다 준비되었습니다. <code>controller</code> 패키지의 <code>BoardController</code> 클래스에 있는 <code>write()</code>를
아래와 같이 수정하여, 업로드한 파일을 서버에 저장하고 데이터베이스에 업데이트하게 구현해보겠습니다.</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BoardController</span> {
    <span class="hljs-keyword">private</span> BoardService boardService;
    <span class="hljs-keyword">private</span> FileService fileService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BoardController</span><span class="hljs-params">(BoardService boardService, FileService fileService)</span> {
        <span class="hljs-built_in">this</span>.boardService = boardService;
        <span class="hljs-built_in">this</span>.fileService = fileService;
    }

    <span class="hljs-comment">/* ... 소스코드 생략 ... */</span>

    <span class="hljs-meta">@PostMapping(&quot;/post&quot;)</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">write</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile files, BoardDto boardDto)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">origFilename</span> <span class="hljs-operator">=</span> files.getOriginalFilename();
            <span class="hljs-type">String</span> <span class="hljs-variable">filename</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MD5Generator</span>(origFilename).toString();
            <span class="hljs-comment">/* 실행되는 위치의 &#x27;files&#x27; 폴더에 파일이 저장됩니다. */</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">savePath</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>) + <span class="hljs-string">&quot;\\files&quot;</span>;
            <span class="hljs-comment">/* 파일이 저장되는 폴더가 없으면 폴더를 생성합니다. */</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(savePath).exists()) {
                <span class="hljs-keyword">try</span>{
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(savePath).mkdir();
                }
                <span class="hljs-keyword">catch</span>(Exception e){
                    e.getStackTrace();
                }
            }
            <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> savePath + <span class="hljs-string">&quot;\\&quot;</span> + filename;
            files.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath));

            <span class="hljs-type">FileDto</span> <span class="hljs-variable">fileDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileDto</span>();
            fileDto.setOrigFilename(origFilename);
            fileDto.setFilename(filename);
            fileDto.setFilePath(filePath);

            <span class="hljs-type">Long</span> <span class="hljs-variable">fileId</span> <span class="hljs-operator">=</span> fileService.saveFile(fileDto);
            boardDto.setFileId(fileId);
            boardService.savePost(boardDto);
        } <span class="hljs-keyword">catch</span>(Exception e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/&quot;</span>;
    }
}
</code></pre>
<p>서버를 실행하고, 파일을 업로드해봅시다.<br>
<img src="/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_2.png" alt="File Upload"></p>
<p>MySQL에서 <code>file</code> 테이블을 조회해보면, 아래와 같이 업로드한 파일 정보가 기록된 것을 볼 수 있습니다.<br>
<img src="/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_3.png" alt="MySQL file Table"></p>
<p>위의 <code>file_path</code>로 가서 열어보면 업로드한 파일이 제대로 서버에 기록되었음을 확인할 수 있습니다.<br>
<img src="/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_4.png" alt="File Check"></p>
<h2>파일 다운로드 구현하기</h2>
<p>글을 열람할 때, 첨부파일이 있으면 첨부파일이 표시되도록 수정합니다.<br>
<code>src\main\resources\templates\board</code>에 있는 <code>detail.html</code>을 아래와 같이 수정합니다.</p>
<pre><code class="language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ko&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;@{&#x27;게시판 - &#x27; + ${post.title}}&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/webjars/bootstrap/4.5.0/css/bootstrap.min.css&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">th:insert</span>=<span class="hljs-string">&quot;common/header.html&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-body&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-title&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;@{${post.title} + &#x27; - &#x27; + ${post.author}}&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-text&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">small</span>
              <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-muted&quot;</span>
              <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;${#temporals.format(post.createdDate, &#x27;yyyy-MM-dd HH:mm&#x27;)}&quot;</span>
            &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-text&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;${post.content}&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;${post.fileId != null}&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>첨부파일 : <span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
              <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-text&quot;</span>
              <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@{&#x27;/download/&#x27; + ${post.fileId}}&quot;</span>
              <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;${filename}&quot;</span>
            &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row mt-3&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-auto mr-auto&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-auto&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-info&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@{&#x27;/post/edit/&#x27; + ${post.id}}&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;button&quot;</span>&gt;</span>수정<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-auto&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;delete-form&quot;</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@{&#x27;/post/&#x27; + ${post.id}}&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_method&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;delete&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;delete-btn&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-danger&quot;</span>&gt;</span>삭제<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/jquery/3.5.1/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/bootstrap/4.5.0/js/bootstrap.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>서버를 실행하면, 아래와 같이 첨부파일이 표시되고 URL은 <code>/download/{fileId}</code>로 설정됩니다.<br>
<img src="/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_5.png" alt="Post Attachments"></p>
<p>이제 <code>/download/{fileId}</code>에 대해 구현하기 위해 <code>controller</code> 패키지에 있는 <code>BoardController</code> 클래스에
아래 내용을 추가합니다.</p>
<pre><code class="language-java"><span class="hljs-meta">@GetMapping(&quot;/download/{fileId}&quot;)</span>
<span class="hljs-keyword">public</span> ResponseEntity&lt;Resource&gt; <span class="hljs-title function_">fileDownload</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;fileId&quot;)</span> Long fileId)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-type">FileDto</span> <span class="hljs-variable">fileDto</span> <span class="hljs-operator">=</span> fileService.getFile(fileId);
    <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(fileDto.getFilePath());
    <span class="hljs-type">Resource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamResource</span>(Files.newInputStream(path));
    <span class="hljs-keyword">return</span> ResponseEntity.ok()
            .contentType(MediaType.parseMediaType(<span class="hljs-string">&quot;application/octet-stream&quot;</span>))
            .header(HttpHeaders.CONTENT_DISPOSITION, <span class="hljs-string">&quot;attachment; filename=\&quot;&quot;</span> + fileDto.getOrigFilename() + <span class="hljs-string">&quot;\&quot;&quot;</span>)
            .body(resource);
}
</code></pre>
<p>서버를 다시 실행하고, 첨부파일을 클릭해봅시다.<br>
정상적으로 다운로드 되는 것을 확인할 수 있습니다.<br>
<img src="/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_6.png" alt="Post Attachments Download"></p>
<h2>업로드 파일 용량 설정하기</h2>
<p>Spring Boot에서 업로드 파일 용량의 기본값은 1MB입니다.<br>
업로드 파일 용량을 늘리고 싶다면, <code>spring.servlet.multipart.maxFileSize</code>와
<code>spring.servlet.multipart.maxRequestSize</code>를 <code>application.properties</code>에 설정해 주면 됩니다.</p>
<p>예를 들면, 아래와 같이 설정할 수 있습니다.</p>
<pre><code>spring.servlet.multipart.maxFileSize=100MB
spring.servlet.multipart.maxRequestSize=100MB
</code></pre>
</div></article></main><footer class="c-cpkrrK"><div class="c-fiqONv">© <!-- -->2022<!-- --></div><div class="c-bHyrwK"><div class="c-iUFgVP">Kh.</div><div class="c-cshSRb">KyuHyuk Lee</div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"excerpt":" 앞의 글 에 서 글을 수정하고 삭제하는 기능을 만들었습니다. 이번 시간에는 파일을 업로드하고 다운로드하는 기능을 구현해보겠습니다. 파일 업로드 구현하기 파일 업로드를 구현하기 전에, 어떤 과정으로 동작하고 어떻게 구현할 것인지 미리 생각해봅시다. 아래는 파일 업로드의 과정입니다. 우리","url":"/article/spring-boot/2020/07/22/Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download","frontmatter":{"title":"[Spring Boot] 게시판 구현 하기 (4) - 파일 업로드 \u0026 다운로드","date":"2020-07-22 23:48:39","category":"Spring-Boot"},"content":"\n[앞의 글](https://kyuhyuk.kr/article/spring-boot/2020/07/21/Spring-Boot-JPA-MySQL-Board-Post-Update-Delete)에\n서 글을 수정하고 삭제하는 기능을 만들었습니다.  \n이번 시간에는 파일을 업로드하고 다운로드하는 기능을 구현해보겠습니다.\n\n## 파일 업로드 구현하기\n\n파일 업로드를 구현하기 전에, 어떤 과정으로 동작하고 어떻게 구현할 것인지 미리 생각해봅시다.  \n아래는 파일 업로드의 과정입니다.  \n![File Upload Flow](/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_1.png)  \n우리가 구현할 것은 4가지입니다.\n\n- '글쓰기' 화면에 파일 업로드 추가하기\n- 업로드한 파일의 정보가 기록될 `file` 테이블 만들기 (Entity, Repository, DTO, Service 만들기)\n- 업로드한 파일 정보의 고유 ID가 `board` 테이블에 기록되도록 변경하기\n- `BoardController`의 `write()`에서 업로드한 파일이 서버에 저장되게 하고 `board`, `file` 테이블에 업\n  데이트 되도록 하기\n\n구현할 목록을 보면서 하나하나 진행해봅시다.\n\n우선, `src\\main\\resources\\templates\\board`에 있는 `post.html`을 아래와 같이 수정합니다.  \n기존 내용에 파일 선택하는 거와 `form`에 `enctype=\"multipart/form-data\"`만 추가하였습니다.\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"ko\" xmlns:th=\"http://www.thymeleaf.org\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"UTF-8\" /\u003e\n    \u003ctitle\u003e게시판 - 글쓰기\u003c/title\u003e\n    \u003clink rel=\"stylesheet\" href=\"/webjars/bootstrap/4.5.0/css/bootstrap.min.css\" /\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cheader th:insert=\"common/header.html\"\u003e\u003c/header\u003e\n    \u003cdiv class=\"container\"\u003e\n      \u003cform action=\"/post\" method=\"post\" enctype=\"multipart/form-data\"\u003e\n        \u003cdiv class=\"form-group row\"\u003e\n          \u003clabel for=\"inputTitle\" class=\"col-sm-2 col-form-label\"\u003e\u003cstrong\u003e제목\u003c/strong\u003e\u003c/label\u003e\n          \u003cdiv class=\"col-sm-10\"\u003e\n            \u003cinput type=\"text\" name=\"title\" class=\"form-control\" id=\"inputTitle\" /\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"form-group row\"\u003e\n          \u003clabel for=\"inputAuthor\" class=\"col-sm-2 col-form-label\"\u003e\u003cstrong\u003e작성자\u003c/strong\u003e\u003c/label\u003e\n          \u003cdiv class=\"col-sm-10\"\u003e\n            \u003cinput type=\"text\" name=\"author\" class=\"form-control\" id=\"inputAuthor\" /\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"form-group row\"\u003e\n          \u003clabel for=\"inputContent\" class=\"col-sm-2 col-form-label\"\u003e\u003cstrong\u003e내용\u003c/strong\u003e\u003c/label\u003e\n          \u003cdiv class=\"col-sm-10\"\u003e\n            \u003ctextarea type=\"text\" name=\"content\" class=\"form-control\" id=\"inputContent\"\u003e\u003c/textarea\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"form-group row\"\u003e\n          \u003clabel for=\"inputFile\" class=\"col-sm-2 col-form-label\"\u003e\u003cstrong\u003e첨부 파일\u003c/strong\u003e\u003c/label\u003e\n          \u003cdiv class=\"col-sm-10\"\u003e\n            \u003cdiv class=\"custom-file\" id=\"inputFile\"\u003e\n              \u003cinput name=\"file\" type=\"file\" class=\"custom-file-input\" id=\"customFile\" /\u003e\n              \u003clabel class=\"custom-file-label\" for=\"customFile\"\u003e파일을 선택해 주세요.\u003c/label\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"row\"\u003e\n          \u003cdiv class=\"col-auto mr-auto\"\u003e\u003c/div\u003e\n          \u003cdiv class=\"col-auto\"\u003e\n            \u003cinput class=\"btn btn-primary\" type=\"submit\" role=\"button\" value=\"글쓰기\" /\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/form\u003e\n    \u003c/div\u003e\n    \u003cscript src=\"/webjars/jquery/3.5.1/jquery.min.js\"\u003e\u003c/script\u003e\n    \u003cscript src=\"/webjars/bootstrap/4.5.0/js/bootstrap.min.js\"\u003e\u003c/script\u003e\n    \u003cscript\u003e\n      $('.custom-file-input').on('change', function () {\n        var fileName = $(this).val().split('\\\\').pop();\n        $(this).siblings('.custom-file-label').addClass('selected').html(fileName);\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\n파일이 업로드되면 '업로드된 실제 파일명', '서버에 저장된 파일명', '파일이 서버에 저장된 위치'가 데이\n터 베이스에 기록되게 프로그램을 작성할 것입니다.  \n우선 업로드된 파일에 대한 데이터가 저장되게 Entity, Repository, DTO, Service를 만들어줍니다.\n\n아래는 `domain.entity` 패키지의 `File` 클래스의 내용입니다.\n\n```java\npackage kr.kyuhyuk.board.domain.entity;\n\nimport lombok.AccessLevel;\nimport lombok.Builder;\nimport lombok.Getter;\nimport lombok.NoArgsConstructor;\n\nimport javax.persistence.Column;\nimport javax.persistence.Entity;\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.Id;\n\n@Getter\n@Entity\n@NoArgsConstructor(access = AccessLevel.PROTECTED)\npublic class File {\n\n    @Id\n    @GeneratedValue\n    private Long id;\n\n    @Column(nullable = false)\n    private String origFilename;\n\n    @Column(nullable = false)\n    private String filename;\n\n    @Column(nullable = false)\n    private String filePath;\n\n    @Builder\n    public File(Long id, String origFilename, String filename, String filePath) {\n        this.id = id;\n        this.origFilename = origFilename;\n        this.filename = filename;\n        this.filePath = filePath;\n    }\n}\n```\n\n아래는 `domain.repository` 패키지의 `FileRepository` 인터페이스의 내용입니다.\n\n```java\npackage kr.kyuhyuk.board.domain.repository;\n\nimport kr.kyuhyuk.board.domain.entity.File;\nimport org.springframework.data.jpa.repository.JpaRepository;\n\npublic interface FileRepository extends JpaRepository\u003cFile, Long\u003e {\n}\n```\n\n아래는 `dto` 패키지의 `FileDto` 클래스의 내용입니다.\n\n```java\npackage kr.kyuhyuk.board.dto;\n\nimport kr.kyuhyuk.board.domain.entity.File;\nimport lombok.*;\n\n@Getter\n@Setter\n@ToString\n@NoArgsConstructor\npublic class FileDto {\n    private Long id;\n    private String origFilename;\n    private String filename;\n    private String filePath;\n\n    public File toEntity() {\n        File build = File.builder()\n                .id(id)\n                .origFilename(origFilename)\n                .filename(filename)\n                .filePath(filePath)\n                .build();\n        return build;\n    }\n\n    @Builder\n    public FileDto(Long id, String origFilename, String filename, String filePath) {\n        this.id = id;\n        this.origFilename = origFilename;\n        this.filename = filename;\n        this.filePath = filePath;\n    }\n}\n```\n\n아래는 `service` 패키지의 `FileService` 클래스의 내용입니다.  \n`saveFile()`은 업로드한 파일에 대한 정보를 기록하고, `getFile()`는 `id` 값을 사용하여 파일에 대한 정\n보를 가져옵니다.\n\n```java\npackage kr.kyuhyuk.board.service;\n\nimport kr.kyuhyuk.board.domain.entity.File;\nimport kr.kyuhyuk.board.domain.repository.FileRepository;\nimport kr.kyuhyuk.board.dto.FileDto;\nimport org.springframework.stereotype.Service;\n\nimport javax.transaction.Transactional;\n\n@Service\npublic class FileService {\n    private FileRepository fileRepository;\n\n    public FileService(FileRepository fileRepository) {\n        this.fileRepository = fileRepository;\n    }\n\n    @Transactional\n    public Long saveFile(FileDto fileDto) {\n        return fileRepository.save(fileDto.toEntity()).getId();\n    }\n\n    @Transactional\n    public FileDto getFile(Long id) {\n        File file = fileRepository.findById(id).get();\n\n        FileDto fileDto = FileDto.builder()\n                .id(id)\n                .origFilename(file.getOrigFilename())\n                .filename(file.getFilename())\n                .filePath(file.getFilePath())\n                .build();\n        return fileDto;\n    }\n}\n```\n\n`domain.entity` 패키지에 있는 `Board`에 `fileId`를 추가합니다.  \n첨부파일은 게시물에 필수로 들어가는 내용이 아니기 때문에, `nullable = false`는 넣지 않았습니다.\n\n```java\npackage kr.kyuhyuk.board.domain.entity;\n\nimport lombok.AccessLevel;\nimport lombok.Builder;\nimport lombok.Getter;\nimport lombok.NoArgsConstructor;\nimport org.springframework.data.annotation.CreatedDate;\nimport org.springframework.data.annotation.LastModifiedDate;\nimport org.springframework.data.jpa.domain.support.AuditingEntityListener;\n\nimport javax.persistence.*;\nimport java.time.LocalDateTime;\n\n@Getter\n@Entity\n@NoArgsConstructor(access = AccessLevel.PROTECTED)\n@EntityListeners(AuditingEntityListener.class) /* JPA에게 해당 Entity는 Auditiong 기능을 사용함을 알립니다. */\npublic class Board {\n\n    @Id\n    @GeneratedValue\n    private Long id;\n\n    @Column(length = 10, nullable = false)\n    private String author;\n\n    @Column(length = 100, nullable = false)\n    private String title;\n\n    @Column(columnDefinition = \"TEXT\", nullable = false)\n    private String content;\n\n    @Column\n    private Long fileId;\n\n    @CreatedDate\n    @Column(updatable = false)\n    private LocalDateTime createdDate;\n\n    @LastModifiedDate\n    private LocalDateTime modifiedDate;\n\n    @Builder\n    public Board(Long id, String author, String title, String content, Long fileId) {\n        this.id = id;\n        this.author = author;\n        this.title = title;\n        this.content = content;\n        this.fileId = fileId;\n    }\n}\n```\n\n`dto` 패키지에 있는 `BoardDto` 클래스에도 `fileId`를 추가합니다.\n\n```java\npackage kr.kyuhyuk.board.dto;\n\nimport kr.kyuhyuk.board.domain.entity.Board;\nimport lombok.*;\n\nimport java.time.LocalDateTime;\n\n@Getter\n@Setter\n@ToString\n@NoArgsConstructor\npublic class BoardDto {\n    private Long id;\n    private String author;\n    private String title;\n    private String content;\n    private Long fileId;\n    private LocalDateTime createdDate;\n    private LocalDateTime modifiedDate;\n\n    public Board toEntity() {\n        Board build = Board.builder()\n                .id(id)\n                .author(author)\n                .title(title)\n                .content(content)\n                .fileId(fileId)\n                .build();\n        return build;\n    }\n\n    @Builder\n    public BoardDto(Long id, String author, String title, String content, Long fileId, LocalDateTime createdDate, LocalDateTime modifiedDate) {\n        this.id = id;\n        this.author = author;\n        this.title = title;\n        this.content = content;\n        this.fileId = fileId;\n        this.createdDate = createdDate;\n        this.modifiedDate = modifiedDate;\n    }\n}\n```\n\n`service` 패키지에 있는 `BoardService` 클래스의 `getPost()`에도 `fileId`를 가져오게 수정합니다.\n\n```java\n@Transactional\npublic BoardDto getPost(Long id) {\n    Board board = boardRepository.findById(id).get();\n\n    BoardDto boardDto = BoardDto.builder()\n            .id(board.getId())\n            .author(board.getAuthor())\n            .title(board.getTitle())\n            .content(board.getContent())\n            .fileId(board.getFileId())\n            .createdDate(board.getCreatedDate())\n            .build();\n    return boardDto;\n}\n```\n\n파일이 업로드되면, MD5 체크섬의 값으로 서버에 저장되게 구현할 것입니다.  \n문자열을 MD5 체크섬으로 변환하는 기능을 구현하기 위해, `util` 패키지를 만들고 `MD5Generator` 클래스\n를 아래와 같이 작성합니다.\n\n```java\npackage kr.kyuhyuk.board.util;\n\nimport java.io.UnsupportedEncodingException;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\n\npublic class MD5Generator {\n    private String result;\n\n    public MD5Generator(String input) throws UnsupportedEncodingException, NoSuchAlgorithmException {\n        MessageDigest mdMD5 = MessageDigest.getInstance(\"MD5\");\n        mdMD5.update(input.getBytes(\"UTF-8\"));\n        byte[] md5Hash = mdMD5.digest();\n        StringBuilder hexMD5hash = new StringBuilder();\n        for(byte b : md5Hash) {\n            String hexString = String.format(\"%02x\", b);\n            hexMD5hash.append(hexString);\n        }\n        result = hexMD5hash.toString();\n    }\n\n    public String toString() {\n        return result;\n    }\n}\n```\n\n이제 모든 것이 다 준비되었습니다. `controller` 패키지의 `BoardController` 클래스에 있는 `write()`를\n아래와 같이 수정하여, 업로드한 파일을 서버에 저장하고 데이터베이스에 업데이트하게 구현해보겠습니다.\n\n```java\npublic class BoardController {\n    private BoardService boardService;\n    private FileService fileService;\n\n    public BoardController(BoardService boardService, FileService fileService) {\n        this.boardService = boardService;\n        this.fileService = fileService;\n    }\n\n    /* ... 소스코드 생략 ... */\n\n    @PostMapping(\"/post\")\n    public String write(@RequestParam(\"file\") MultipartFile files, BoardDto boardDto) {\n        try {\n            String origFilename = files.getOriginalFilename();\n            String filename = new MD5Generator(origFilename).toString();\n            /* 실행되는 위치의 'files' 폴더에 파일이 저장됩니다. */\n            String savePath = System.getProperty(\"user.dir\") + \"\\\\files\";\n            /* 파일이 저장되는 폴더가 없으면 폴더를 생성합니다. */\n            if (!new File(savePath).exists()) {\n                try{\n                    new File(savePath).mkdir();\n                }\n                catch(Exception e){\n                    e.getStackTrace();\n                }\n            }\n            String filePath = savePath + \"\\\\\" + filename;\n            files.transferTo(new File(filePath));\n\n            FileDto fileDto = new FileDto();\n            fileDto.setOrigFilename(origFilename);\n            fileDto.setFilename(filename);\n            fileDto.setFilePath(filePath);\n\n            Long fileId = fileService.saveFile(fileDto);\n            boardDto.setFileId(fileId);\n            boardService.savePost(boardDto);\n        } catch(Exception e) {\n            e.printStackTrace();\n        }\n        return \"redirect:/\";\n    }\n}\n```\n\n서버를 실행하고, 파일을 업로드해봅시다.  \n![File Upload](/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_2.png)\n\nMySQL에서 `file` 테이블을 조회해보면, 아래와 같이 업로드한 파일 정보가 기록된 것을 볼 수 있습니다.  \n![MySQL file Table](/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_3.png)\n\n위의 `file_path`로 가서 열어보면 업로드한 파일이 제대로 서버에 기록되었음을 확인할 수 있습니다.  \n![File Check](/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_4.png)\n\n## 파일 다운로드 구현하기\n\n글을 열람할 때, 첨부파일이 있으면 첨부파일이 표시되도록 수정합니다.  \n`src\\main\\resources\\templates\\board`에 있는 `detail.html`을 아래와 같이 수정합니다.\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"ko\" xmlns:th=\"http://www.thymeleaf.org\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"UTF-8\" /\u003e\n    \u003ctitle th:text=\"@{'게시판 - ' + ${post.title}}\"\u003e\u003c/title\u003e\n    \u003clink rel=\"stylesheet\" href=\"/webjars/bootstrap/4.5.0/css/bootstrap.min.css\" /\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cheader th:insert=\"common/header.html\"\u003e\u003c/header\u003e\n    \u003cdiv class=\"container\"\u003e\n      \u003cdiv class=\"card\"\u003e\n        \u003cdiv class=\"card-body\"\u003e\n          \u003ch5 class=\"card-title\" th:text=\"@{${post.title} + ' - ' + ${post.author}}\"\u003e\u003c/h5\u003e\n          \u003cp class=\"card-text\"\u003e\n            \u003csmall\n              class=\"text-muted\"\n              th:text=\"${#temporals.format(post.createdDate, 'yyyy-MM-dd HH:mm')}\"\n            \u003e\u003c/small\u003e\n          \u003c/p\u003e\n          \u003cp class=\"card-text\" th:text=\"${post.content}\"\u003e\u003c/p\u003e\n          \u003cdiv th:if=\"${post.fileId != null}\"\u003e\n            \u003cstrong\u003e첨부파일 : \u003c/strong\u003e\n            \u003ca\n              class=\"card-text\"\n              th:href=\"@{'/download/' + ${post.fileId}}\"\n              th:text=\"${filename}\"\n            \u003e\u003c/a\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"row mt-3\"\u003e\n        \u003cdiv class=\"col-auto mr-auto\"\u003e\u003c/div\u003e\n        \u003cdiv class=\"col-auto\"\u003e\n          \u003ca class=\"btn btn-info\" th:href=\"@{'/post/edit/' + ${post.id}}\" role=\"button\"\u003e수정\u003c/a\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"col-auto\"\u003e\n          \u003cform id=\"delete-form\" th:action=\"@{'/post/' + ${post.id}}\" method=\"post\"\u003e\n            \u003cinput type=\"hidden\" name=\"_method\" value=\"delete\" /\u003e\n            \u003cbutton id=\"delete-btn\" type=\"submit\" class=\"btn btn-danger\"\u003e삭제\u003c/button\u003e\n          \u003c/form\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n    \u003cscript src=\"/webjars/jquery/3.5.1/jquery.min.js\"\u003e\u003c/script\u003e\n    \u003cscript src=\"/webjars/bootstrap/4.5.0/js/bootstrap.min.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\n서버를 실행하면, 아래와 같이 첨부파일이 표시되고 URL은 `/download/{fileId}`로 설정됩니다.  \n![Post Attachments](/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_5.png)\n\n이제 `/download/{fileId}`에 대해 구현하기 위해 `controller` 패키지에 있는 `BoardController` 클래스에\n아래 내용을 추가합니다.\n\n```java\n@GetMapping(\"/download/{fileId}\")\npublic ResponseEntity\u003cResource\u003e fileDownload(@PathVariable(\"fileId\") Long fileId) throws IOException {\n    FileDto fileDto = fileService.getFile(fileId);\n    Path path = Paths.get(fileDto.getFilePath());\n    Resource resource = new InputStreamResource(Files.newInputStream(path));\n    return ResponseEntity.ok()\n            .contentType(MediaType.parseMediaType(\"application/octet-stream\"))\n            .header(HttpHeaders.CONTENT_DISPOSITION, \"attachment; filename=\\\"\" + fileDto.getOrigFilename() + \"\\\"\")\n            .body(resource);\n}\n```\n\n서버를 다시 실행하고, 첨부파일을 클릭해봅시다.  \n정상적으로 다운로드 되는 것을 확인할 수 있습니다.  \n![Post Attachments Download](/assets/image/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download/2020-07-22-Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download_6.png)\n\n## 업로드 파일 용량 설정하기\n\nSpring Boot에서 업로드 파일 용량의 기본값은 1MB입니다.  \n업로드 파일 용량을 늘리고 싶다면, `spring.servlet.multipart.maxFileSize`와\n`spring.servlet.multipart.maxRequestSize`를 `application.properties`에 설정해 주면 됩니다.\n\n예를 들면, 아래와 같이 설정할 수 있습니다.\n\n```\nspring.servlet.multipart.maxFileSize=100MB\nspring.servlet.multipart.maxRequestSize=100MB\n```\n"},"__N_SSG":true},"page":"/article/[category]/[year]/[month]/[day]/[slug]","query":{"category":"spring-boot","year":"2020","month":"07","day":"22","slug":"Spring-Boot-JPA-MySQL-Board-Post-File-Upload-Download"},"buildId":"Dsgna1Ug9ERZ37IDpNGla","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>